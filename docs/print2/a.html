<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>情報プログレス</title>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <header class="site-header">
        <div class="toolbar">
            <button id="toggle-preview">プレビュー表示</button>
            <button id="show-answers">答えを表示</button>
        </div>
        <div class="gen-table">5 10 9 12 10 3</div>
    </header>

    <main>
        <h1>情報プログレス ２学期総括テスト</h1>
        <ol class="level1">
            <li>
                <div class="title-row">
                    <span class="title-text">次の質問に答えなさい。</span>

                    <div class="your-point">
                        <span class="label">知識・技能</span>
                        <span class="total">/ 20</span>
                    </div>
                </div>


                <ol class="level2">
                    <li>JavaScript のプログラムを、複数のファイルに正式な仕組みとして分割して扱うときに用いられる名称は何か。<!-- モジュール --></li>
                    <li>別ファイルのモジュールから関数や変数などの機能を自分のファイルへ読み込むときに使う JavaScript の文は何か。<!-- import文 --></li>
                    <li>自分のファイル（モジュール）内の関数や変数を他のモジュールから利用できるように公開するときに使うJavaScript の文は何か。<!-- export文 --></li>
                    <li>JavaScript で「コンソールに値を出力するための標準的な命令」は何か。<!-- console.log() --></li>
                    <li>JavaScript で関数を定義するときに必ず書くキーワードは何か。<!-- function --></li>
                    <li>JavaScript の配列から「指定した位置の要素を削除したり、置き換えたりする標準メソッド」は何か。<!-- splice --></li>
                    <li>関数の内部から「値を呼び出し元へ返す」ために使うキーワードは何か。<!-- return --></li>
                    <li>JavaScript で「再代入不可の変数」を宣言するときに使うキーワードは何か。<!-- const --></li>
                    <li>JavaScript で「再代入可能な変数」を宣言するときに使うキーワードは何か。<!-- let --></li>
                    <li>HTML5 Canvas で、<u>画像をキャンバスに描画するときに用いる</u>2D コンテキストのメソッドは何か。<!-- drawImage --></li>
                </ol>
            </li>
            <li>
                <div class="title-row">
                    <span class="title-text">プログラムを読んで、質問に答えなさい。</span>
                    <div class="your-point">
                        <span class="label">知識・技能</span>
                        <span class="total">/ 18</span>
                    </div>
                </div>
                <!-- main.js -->
                <pre><code class="code-sample">import { player, initPlayer, drawPlayer } from "./player.js";
import { spawnEnemy, enemies, updateEnemies, drawEnemies } from "./enemies.js";
import { handleCollisions } from "./collision.js";
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const mapImage = new Image();
mapImage.src = "map.png";
initPlayer(canvas);
export const bullets = [];
const BULLET_SPEED = -5;
function tryShoot() {
    bullets.push({
        x: player.x + player.width / 2 - 5,
        y: player.y,
        width: 10,
        height: 10,
        vy: BULLET_SPEED,
    })
}
function updateScore() {
    const scoreBoard = document.getElementById("scoreBoard");
    scoreBoard.innerText = `Score: ` + player.score;
    const lifeBoard = document.getElementById("lifeBoard");
    lifeBoard.innerText = `Life: ` + player.life;
}
window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") {
        if (player.x > 10) {
            player.x -= 10;
        }
    } else if (e.key === "ArrowRight") {
        if (player.x < canvas.width - player.width - 10) {
            player.x += 10;
        }
    } else if (e.code === "Space") {
        tryShoot();
    }
});
function update() {
    for (let i = 0; i < bullets.length; i++) {
        const bullet = bullets[i];
        bullet.y += bullet.vy;
        if (bullet.y < 0) {
            bullets.splice(i, 1);
        }
    }
    spawnEnemy(canvas);
    updateEnemies(canvas);
    handleCollisions();
    updateScore();
}
function draw() {
    ctx.fillStyle = "black";
    ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
    drawPlayer(ctx);
    ctx.fillStyle = "white";
    for (let i = 0; i < bullets.length; i++) {
        const bullet = bullets[i];
        ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
    }
    drawEnemies(ctx);
}
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}
gameLoop();</code></pre>
                <ol class="level2">
                    <li>このプログラムにおいて、図形や画像を描くための描画用オブジェクトは何か。<!-- ctx --></li>
                    <li>弾配列の一覧を管理している変数は何か。<!-- bullets --></li>
                    <li>球を発射する関数は何か。<!-- tryShoot() --></li>
                    <li><code>window.addEventListener("keydown")</code> は何を処理する機能か。<!-- キー入力 --></li>
                    <li><code>update()</code> は何をアップデートしているか。<!-- 状態 --></li>
                    <li><code>requestAnimationFrame()</code> がゲームループを呼び出すタイミングはいつか。<!-- フレーム --></li>
                    <li>自機の移動速度を変えたい場合、どの値を変えるべきか。<!-- player.x += 10 --></li>
                    <li>弾の大きさを変えたい場合、どこの値を変更するべきか。<!-- tryShoot() 内の width と height --></li>
                    <li>背景画像を動かしてスクロール演出をしたい場合、どのような画像を用いると良いか。<!-- 上端と下端がつながるような画像・タイル状の画像 --></li>
                </ol>

            </li>
            <li>
                <div class="title-row">
                    <span class="title-text">プログラムを読んで、質問に答えなさい。</span>
                    <div class="your-point">
                        <span class="label">思考・判断・表現</span>
                        <span class="total">/ 24</span>
                    </div>
                </div>
                <!-- collision.js -->
                <pre><code class="code-sample">import { player } from "./player.js";
import { enemies } from "./enemies.js";
import { bullets } from "./main.js";
export function handleCollisions() {
  for (let ei = enemies.length - 1; ei >= 0; ei--) {
    const e = enemies[ei];
    let hit = false;
    for (let bi = bullets.length - 1; bi >= 0; bi--) {
      const b = bullets[bi];
      if (rectsIntersect(
        { x: b.x, y: b.y, width: b.width, height: b.height },
        { x: e.x, y: e.y, width: e.width, height: e.height }
      )) {
        bullets.splice(bi, 1);
        enemies.splice(ei, 1);
        player.score += 1;
        console.log("Score:", player.score);
        hit = true;
        break; 
      }
    }
    if (hit) continue;
  }
  for (let ei = enemies.length - 1; ei >= 0; ei--) {
    const e = enemies[ei];
    if (rectsIntersect(
      { x: player.x, y: player.y,
        width: player.width, height: player.height },
      { x: e.x, y: e.y, width: e.width, height: e.height }
    )) {
      player.life -= 1;
      if (player.life &lt;= 0) {
        document.location.reload();
      }
      enemies.splice(ei, 1);
      console.log("Player Life:", player.life);
      break;
    }
  }
}
function rectsIntersect(a, b) {
  return (
    a.x &lt; b.x + b.width &amp;&amp;
    a.x + a.width &gt; b.x &amp;&amp;
    a.y &lt; b.y + b.height &amp;&amp;
    a.y + a.height &gt; b.y
  );
}</code></pre>
                <ol class="level2">
                    <li><code>handleCollisions()</code>関数の役割はなんですか。<!-- 当たり判定 --></li>
                    <li>使用されているループは、逆順になっている。その理由を<code>splice</code>という語句を使用して説明しなさい。<!-- spliceしてもインデックスがずれないため -->
                    </li>
                    <li><code>let hit = false;</code>は、その敵にすでに弾が当たったかどうかを記録するために用いる。一般的に何と言われるか。<!-- フラグ --></li>
                    <li><code>if (player.life &lt;= 0) { document.location.reload(); }</code>は、どのような処理です。<!-- ライフが0以下になったらページを再読み込みしてゲームを最初からにする処理 -->
                    </li>
                    <li><code>rectsIntersect(a, b)</code> 関数は、何を調べる関数ですか。<!-- 2つの四角形が重なっているかどうか --></li>
                    <li><code>rectsIntersect(a, b)</code> は、何を返す関数ですか。<!-- 真偽値（true または false） --></li>
                    <li><code>rectsIntersect</code> 関数で使われている当たり判定手法の正式名称を答えなさい。<!-- AABB（軸平行境界ボックス）--></li>
                    <li>上の問題の手法のように特定の問題を解決するための手順や計算方法、処理手順を一般的になんというか。<!-- アルゴリズム --></li>
                    <li><code>hit</code> フラグが true になった後に、再度当たり判定が起こらないように使われている制御文は何か。<!-- continue --></li>
                    <li>コアを 1 点ではなく、敵によって 10 点や 100 点など変えたい場合、コードのどの部分をどのように変えればよいか。<!-- player.score += 1 を変更する-->
                    </li>
                    <li>上記の問題において、今後のことも考えるとより良い方法がある。どのような手法が考えられるか。オブジェクトという言葉を使って示しなさい。<!-- enemies 配列の各オブジェクトに score プロパティを追加し、当たり判定で加算するスコアを変える -->
                    </li>
                    <li>「自機と敵が当たったら即ゲームオーバー」にしたい場合、どこを変更することが簡単か日本語で説明せよ。<!-- 当たったらすぐ reload するだけにする --></li>
                </ol>
            </li>
            <li>
                <div class="title-row">
                    <span class="title-text">プログラムを読んで、質問に答えなさい。</span>
                    <div class="your-point">
                        <span class="label">思考・判断・表現</span>
                        <span class="total">/ 20</span>
                    </div>
                </div>
                <!-- enemies.js -->
                <pre><code class="code-sample">export const enemies = [];
const SIZE = 50;
const enemyImage = new Image();
enemyImage.src = "enemy.png";
function pushEnemies(canvas) {
  const w = SIZE;
  const h = SIZE;
  const x = Math.random() * (canvas.width - w);
  const y = 0;
  const vy = 5
  enemies.push({ x, y, width: w, height: h, vy });
}
export function spawnEnemy(canvas) {
 if (enemies.length < 10) {
    pushEnemies(canvas);
 }
}
export function updateEnemies(canvas) {
  for (let i = enemies.length - 1; i >= 0; i--) {
    const e = enemies[i];
    e.y += e.vy;
    if (e.y > canvas.height) {
      enemies.splice(i, 1);
    }
  }
}
export function drawEnemies(ctx) {
  for (const e of enemies) {
     ctx.drawImage(enemyImage, e.x, e.y, e.width, e.height);
  }
}</code></pre>
                <ol class="level2">
                    <li>ここで使用されている配列の配列名はなにか。<!-- enemies --></li>
                    <li>敵の大きさを変えるには、なにを変更するか。<!-- SIZE --></li>
                    <li>このプログラムでは敵画像はなんというファイル名か。<!-- enemy.png --></li>
                    <li><code>Math.random() * (canvas.width - w)</code> は、敵の位置をどのようにするか。<!-- ランダムな位置 --></li>
                    <li><code>spawnEnemy()</code> はどのような処理を行う関数か。<!-- 敵をスポーンさせる --></li>
                    <li><code>updateEnemies()</code> は敵をどの方向に動かす処理か。<!-- 下方向 --></li>
                    <li>敵が画面端についたときの処理は何か。配列という言葉を使って説明しなさい。<!-- 配列から削除 --></li>
                    <li>drawEnemies()の役割は何か。<!-- 敵を描画する --></li>
                    <li>敵の数をもっと増やしたい場合、どこの値を変更すれば良いか？<!-- spawnEnemy 内の enemies.length < 10 --></li>
                    <li>複数の敵を作りたい場合、どの関数を改造すると良いか？<!-- pushEnemies() --></li>
                </ol>
            </li>
            <li>
                <div class="title-row">
                    <span class="title-text">プログラムを読んで、質問に答えなさい。</span>

                    <div class="your-point">
                        <span class="label">知識・技能</span>
                        <span class="total">/ 6</span>
                    </div>
                </div>
                <!-- player.js -->
                <pre><code class="code-sample">const playerImage = new Image();
playerImage.src = "player.png";
export const player = {
    x: 0,
    y: 0,
    width: 30,
    height: 30,
    color: "yellow",
    life: 3,
    score: 0,
};
export function initPlayer(canvas) {
    player.x = canvas.width / 2 - player.width / 2;
    player.y = canvas.height - 60;
    console.log("Player:", player);
}
export function drawPlayer(ctx) {
    ctx.drawImage(playerImage, player.x, player.y,
    player.width, player.height);
}</code></pre>

                <ol class="level2">
                    <li>このプログラムのオブジェクトが保有する情報は何ですか。5つ答えなさい。<!-- プレイヤーの位置・大きさ・色・ライフ・スコア --></li>
                    <li><code>initPlayer(canvas)</code> はプレイヤーの何を設定する関数ですか。<!-- 初期位置 --></li>
                    <li>プレイヤーを横方向の中央に配置するための計算式はなにか。<!-- canvas.width / 2 - player.width / 2 --></li>
                </ol>
            </li>
            <li>
                <div class="title-row">
                    <span class="title-text">次のプログラムを実行する => の右側のような出力が得られる。そのプログラムを作成しなさい。</span>
                    <div class="your-point">
                        <span class="label">主体的に学びに向かう態度</span>
                        <span class="total">/ 12</span>
                    </div>
                </div>
            </li>
            <ol class="level2">
                <li><code>console.log(cat.name);</code> => たま</li>
                <li><code>console.log(cat.age);</code> => 3</li>
                <li><code>console.log(cat.color);</code> => black</li>
                <li><code>console.log(add(6,2));</code> => 8</li>
            </ol>
            <div class="page-break"></div>
    </main>
    <sub>
        <h1>情報プログレス ２学期総括テスト</h1>
        <div id="output"></div>
        <table class="large-table">
            <td>6</td>
        </table>
        <table>
            <td>番号</td>
            <td>氏名</td>
            <td>得点</td>
        </table>
        <div class="page-break"></div>
        <h1>情報プログレス ２学期総括テスト</h1>
        <div id="ans-output"></div>
        <table class="large-table">
            <td>6
                <pre><code>cat={ name: "たま", age: 3, color: "black" };
function add(a, b) { return a + b; }</code></pre>
            </td>
        </table>
    </sub>
    <script src="generate-table.js"></script>
    <script src="ui.js"></script>
</body>

</html>